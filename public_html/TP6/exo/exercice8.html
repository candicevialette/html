<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Générateur de Devis - Béton</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h1 {
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 30px;
    }

    /* Formulaire */
    form {
      max-width: 500px;
      margin: 0 auto 2rem auto;
      padding: 1rem;
      border: 1px solid #ccc;
    }
    .champ {
      display: flex;
      flex-direction: column;
      margin-bottom: 1rem;
    }
    .champ label {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .champ input {
      padding: 0.4rem;
    }

    /* Section Devis */
    #sectionDevis {
      display: none; /* masqué par défaut */
      max-width: 700px;
      margin: 0 auto;
      border: 1px solid #000;
      padding: 20px;
    }
    .header-devis {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }
    .header-devis div {
      max-width: 50%;
    }
    .header-devis h2 {
      margin: 0;
      font-size: 1.8rem;
      text-transform: uppercase;
    }
    .header-devis p {
      margin: 0.2rem 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    table thead {
      background: #f0f0f0;
    }
    table th,
    table td {
      border: 1px solid #000;
      padding: 8px;
      text-align: left;
    }
    .totaux {
      margin-top: 1rem;
      text-align: right;
    }
    .totaux p {
      margin: 0.3rem 0;
    }
    .footer-devis {
      text-align: center;
      margin-top: 2rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
<a href ="https://candicevialette.github.io/html/public_html/TP6/presentation.html">retour au TP06</a>
<a href="https://candicevialette.github.io/html/public_html/TP6/exo/exercice7.html">Si vous avez pas toutes les informations, on vous les calculs pour vous ici</a>
<h1>Générateur de Devis</h1>

<form id="formDevis">
  <h2>Informations Client</h2>
  <div class="champ">
    <label for="nomClient">Nom du client <span style="color:red">*</span></label>
    <input type="text" id="nomClient" name="nomClient" required>
  </div>
  <div class="champ">
    <label for="telClient">Téléphone <span style="color:red">*</span></label>
    <input type="tel" id="telClient" name="telClient" required pattern="^(\+?\d+)?$" 
           placeholder="+33 6 12 34 56 78">
  </div>
  <div class="champ">
    <label for="emailClient">Email</label>
    <input type="email" id="emailClient" name="emailClient" placeholder="exemple@domaine.com">
  </div>
  <div class="champ">
    <label for="adresseClient">Adresse</label>
    <input type="text" id="adresseClient" name="adresseClient" placeholder="N° et rue, Ville, Code Postal">
  </div>

  <h2>Paramètres du Béton</h2>
  <div class="champ">
    <label for="longueur">Longueur (m) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="longueur" name="longueur" min="0" required>
  </div>
  <div class="champ">
    <label for="largeur">Largeur (m) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="largeur" name="largeur" min="0" required>
  </div>
  <div class="champ">
    <label for="hauteur">Hauteur/Épaisseur (m) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="hauteur" name="hauteur" min="0" required>
  </div>
  <div class="champ">
    <label for="densiteCiment">Densité de ciment (tonnes/m³) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="densiteCiment" name="densiteCiment" min="0" required 
           placeholder="Ex: 0.35 tonnes/m³">
  </div>
  <div class="champ">
    <label for="capCamion">Capacité d'un camion (m³) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="capCamion" name="capCamion" min="1" required value="6">
  </div>
  <div class="champ">
    <label for="prixM3">Prix du béton (€/m³) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="prixM3" name="prixM3" min="0" required value="100">
  </div>
  <div class="champ">
    <label for="tva">Taux de TVA (%) <span style="color:red">*</span></label>
    <input type="number" step="0.01" id="tva" name="tva" min="0" required value="20">
  </div>

  <button type="button" onclick="genererDevis()">Obtenir le devis</button>
</form>

<!-- Section Devis (masquée au départ) -->
<div id="sectionDevis">
  <div class="header-devis">
    <div>
      <h2>Devis</h2>
      <p id="factureNum">Facture n°12345</p>
      <p id="dateFacture"></p>
    </div>
    <div>
      <p id="infoClient"></p>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th>Valeur</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Volume de béton nécessaire</td>
        <td id="valVolume"></td>
      </tr>
      <tr>
        <td>Quantité de ciment</td>
        <td id="valCiment"></td>
      </tr>
      <tr>
        <td>Nombre de camions nécessaires</td>
        <td id="valCamions"></td>
      </tr>
      <tr>
        <td>Prix HT</td>
        <td id="valHT"></td>
      </tr>
      <tr>
        <td>Prix TTC</td>
        <td id="valTTC"></td>
      </tr>
    </tbody>
  </table>

  <div class="footer-devis">
    <p>Merci de votre confiance</p>
  </div>
</div>

<script>
function genererDevis() {
  // Récupération des champs
  const nomClient   = document.getElementById('nomClient');
  const telClient   = document.getElementById('telClient');
  const emailClient = document.getElementById('emailClient');
  const adrClient   = document.getElementById('adresseClient');
  const longueur    = document.getElementById('longueur');
  const largeur     = document.getElementById('largeur');
  const hauteur     = document.getElementById('hauteur');
  const densiteC    = document.getElementById('densiteCiment');
  const capCamion   = document.getElementById('capCamion');
  const prixM3      = document.getElementById('prixM3');
  const tva         = document.getElementById('tva');

  // Vérifications simples côté JS (en plus du "required" HTML)
  if(!nomClient.value.trim() || !telClient.value.trim() ||
     !longueur.value || !largeur.value || !hauteur.value ||
     !densiteC.value || !capCamion.value || !prixM3.value || !tva.value) {
    alert("Merci de remplir tous les champs obligatoires.");
    return;
  }

  // Conversion numérique
  const L = parseFloat(longueur.value);
  const l = parseFloat(largeur.value);
  const h = parseFloat(hauteur.value);
  const d = parseFloat(densiteC.value);
  const camion = parseFloat(capCamion.value);
  const pM3 = parseFloat(prixM3.value);
  const tvaVal = parseFloat(tva.value);

  // Vérifications de valeurs négatives ou nulles
  if(L <= 0 || l <= 0 || h <= 0 || d < 0 || camion <= 0 || pM3 < 0 || tvaVal < 0) {
    alert("Veuillez saisir des valeurs numériques positives.");
    return;
  }

  // Calculs
  const volumeBeton = L * l * h;                      // m³
  const quantiteCiment = volumeBeton * d;             // tonnes
  const nbCamions = Math.ceil(volumeBeton / camion);  // arrondi supérieur
  const prixHT = volumeBeton * pM3;                   // €
  const prixTTC = prixHT * (1 + (tvaVal / 100));      // €

  // Affichage dans le devis
  document.getElementById('infoClient').innerHTML =
    `<strong>A l'attention de :</strong><br>
     ${nomClient.value}<br>
     Tél : ${telClient.value}<br>
     ${emailClient.value ? 'Email : ' + emailClient.value + '<br>' : ''}
     ${adrClient.value ? 'Adresse : ' + adrClient.value : ''}`;

  // Date du jour
  const dateNow = new Date().toLocaleDateString('fr-FR');
  document.getElementById('dateFacture').textContent = `Date : ${dateNow}`;

  document.getElementById('valVolume').textContent = volumeBeton.toFixed(2) + " m³";
  document.getElementById('valCiment').textContent = quantiteCiment.toFixed(2) + " tonnes";
  document.getElementById('valCamions').textContent = nbCamions;
  document.getElementById('valHT').textContent = prixHT.toFixed(2) + " €";
  document.getElementById('valTTC').textContent = prixTTC.toFixed(2) + " €";

  // Affichage de la section Devis
  document.getElementById('sectionDevis').style.display = 'block';
}
</script>

</body>
</html>

